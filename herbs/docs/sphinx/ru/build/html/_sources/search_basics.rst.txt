======================================
Базовый поиск по электронному гербарию
======================================

.. |---| unicode:: U+2014  .. em dash


Возможности
-----------

Доступ к данным электронного гербария осуществляется либо через предоставляемый web-интерфейс
на `официальном сайте организации <http://botsad.ru/herbarium>`_,
либо посредством использования :doc:`сервиса <http_api>` автоматизированной обработки поисковых запросов.

В поиске участвуют только опубликованные гербарные записи.

Основные возможности поиска через web-интерфейс:

* поиск в заданных временных интервалах сбора и определения образцов;
* поиск по синонимам видов;
* поиск по заданной прямоугольной географической области;
* поиск по дополнительным видам (для мультивидовых сборов) и истории определений;
* поиск по коду образца;
* поиск по стране места сбора образца;
* поиск по таксономической принадлежности (семейство, род, видовой эпитет)

Поисковое меню
--------------

Базовые поисковые операции возможны через поисковое меню на странице каталога электронного гербария (:ref:`Рис. 1<fig1>`)

.. index:: поиск, web-форма

.. _fig1:

.. figure:: files/search/1.png
   :alt: Стандартные поисковые операции
   :align: center

   Рис. 1. Вид стандартного поискового меню


При задании нескольких условий в поисковом меню результатом поиска являются записи,
для которых выполняются все условия одновременно. Таким образом, поисковое меню позволяет
формировать поисковые запросы типа **И**. При необходимости выполнения поисковых запросов
типа **ИЛИ** рекомендуется использовать предоставляемый
:doc:`сервис <http_api>` автоматизации поисковых запросов.


Выбор значений полей **Семейство**, **Род** и **Страна** осуществляется из выпадающего списка,
формируемого исходя из известных  семейств, родов |---| у опубликованных
образцов и всех известных стран соответственно.

Дата начала и окончания сбора задаются при помощи автоматически
всплывающего календаря при попытке внесения значений в эти поля.

В случае задания только даты начала сбора |---| условие поиска считается выполненным для тех записей,
у которых дата начала сбора больше указанной даты начала сбора.

В случае задания только даты окончания сбора |---| условие поиска считается выполненным для 
тех записей, у которых дата окончания сбора меньше указанной даты окончания сбора.

В случае задания дат начала и окончания сбора одновременно |---| условие поиска считается
выполненным для тех записей, у которых интервал соответствующих дат пересекается
с указанным временным интервалом сбора.

В отношении остальных текстовых полей |---|
**видовой эпитет**, **код**, **собрали**, **определили**, **место сбора** |---|
выполнение поискового условия предполагает включение  введенной подстроки
(без учёта регистра) в соответствующее поле записей таблицы опубликованных гербарных записей.

В случае поиска по полям **собрали** и/или **определили**, если значения
полей записаны кириллическими символами, поисковый запрос также
выполняется по транслитерированным  значениям, обратная транслитерация при этом не выполняется.
Таким образом, если, например, выполнить поиск с полем **собрали** равным "бакалин",
то будут найдены все образцы, у которых в поле собрали значится подстрока "bakalin" либо "бакалин"; однако,
если поиск изначально выполнить по строке "bakalin", то образцы, у которых в данном поле
использованы кириллические символы ("бакалин"), не будут найдены.

Булевы поля **Учитывать синонимы** и **Искать в дополнительных видах**
указывают, что: в первом случае |---| дополнительно будет использоваться
таблица синонимов видов при поиске образцов, а во втором случае |---| что поиск
также будет распространяться на присоединённые к данному гербарному сбору
другие виды (для мультивидовых сборов).
В случае, когда отмечены оба поля поиск по известным системе синонимам видов будет
проводится также и во всех присоединённых видах гербарных сборов.


.. note::

   Функция учитывать синонимы работает только в случае точного
   указания пары (род, видовой эпитет), в противном случае |---| условие поиска по
   синонимам игнорируется и в результатах поиска выводится соответствующее предупреждение,
   что условие было проигнорировано.


Отдельно следует отметить особенности поиска по  полю **Код**.

Электронные гербарные записи БСИ ДВО РАН
имеют тройную систему кодирования |---| инвентарный номер образца (используемый в хранилище), уникальный числовой ID
гербарной записи, назначаемый системой, а также полевой код, назначаемый сборщиком гербария.

В связи с этим, таблица результатов поиска имеет колонку **Код сбора (комбинированный)**, в
которой отражены все три кода, если таковые заданы.

Комбинированный код имеет следующую структуру:

.. note::

    Инвентарный номер или символ \*/ID образца/Полевой код образца, если задан


Таким образом, возможны следующие варианты:

* \*/27031/M.I.38 |---| означает, что инвентарный номер образца не задан,
  автоматически присваиваемый уникальный номер (ID записи) образца |---| 27031, а полевой код, присвоенный
  сборщиком гербария |---| M.I.38;
* 42/27029 |---| инвентарный номер |---| 47, уникальный ID записи |---| 27029, полевой код |---| не задан;
* возможны также ситуации, когда заданы все три кода, в этом случае комбинированный код имеет, например, вид:
  132123/32032/F-3829-3k (*это, однако, гипотетический пример, так как действительный образец со всеми тремя заданными кодами я не нашел*)

Выполняя поиск по полю **Код** необходимо задавать какой-либо один из кодов; система автоматически выполнит
поиск с учетом соответствия значения любому из трех кодовых полей записи. Например, если в поле **Код** задано "231"
будут найдены все образцы у которых в каком-либо кодовом поле (либо инвентарном коде, либо ID, либо полевом коде)
встречается подстрока "231".


Фильтрация результатов поиска
-----------------------------


Стандартный поисковый интерфейс предоставляет возможность фильтрации результатов поиска
по подразделам гербария, а также по гербарным акронимам. 
Панель фильтрации результатов поиска дана на  :ref:`Рис. 2<fig2>`.

.. index:: фильтр поиска

.. _fig2:

.. figure:: files/search/2.png
   :alt: Панель фильтрации результатов поиска
   :align: center

   Рис. 2. Панель фильтрации результатов поиска

Панель фильтрации результатов поиска имеет следующие поля:

* **Количество** |---|  количество найденных образцов, отображаемых на одной странице;
* **Название гербария** |---|  ограничение результатов поиска акрониму;
* **Подраздел гербария** |---|  ограничение результатов поиска по подразделу гербария;
* **Упорядочить** |---|  упорядочивание результатов по какому-либо из полей; справа |---| булево поле для
                         смены порядка отображаемых результатов.

Вид панели результатов выполнения поискового запроса дан на :ref:`Рис. 3<fig3>`.

Во вкладке **Общая информация** выводится перечень удовлетворяющих текущему поисковому условию
(в случае, если никаких поисковых условий не было задано |---| выводятся все опубликованные записи,
внесённые в базу на текущий момент).

Вкладка **Информация об образце** активируется, при попытке посмотреть
информацию о конкретной гербарной записи в таблице результатов.
В этой вкладке отображается уменьшенная копия персональной страницы образца.

Вкладка **Карта** представляет собой результаты поиска с их отображением на карте.
Как и в случае со вкладкой **Общая информация** на карте отображается
только одна страница результатов поиска. Страницы результатов поиска можно листать,
нажимая ссылки **Предыдущая** и **Следующая**, что приведет
к синхронному изменению отображаемых записей как на **Карте**,
так и во вкладке **Общая информация**.

Вкладка **Автоматизация доступа** содержит общую информацию об организации автоматизированного
доступа посредством предоставляемого :doc:`сервиса HTTP API <http_api>`.


Во вкладке **Карта** также имеется возможность фильтрации результатов поиска
по прямоугольной области, определённой пользователем на карте.
Если область географической фильтрации задана, то в поиске участвуют только
те записи, у которых определены географические координаты сбора.

.. _fig3:

.. figure:: files/search/3.png
   :alt: Панель результатов поиска
   :align: center

   Рис. 3. Панель результатов поиска


Для активации поиска по географической области необходимо нажать
(или дважды кликнуть по окну карты) на кнопку поиска.
При этом на карте появится редактируемая прямоугольная область поиска (:ref:`Рис. 4<fig4>`, :ref:`Рис. 5<fig5>`).

.. index::  карта

.. _fig4:

.. figure:: files/search/4.png
   :alt: Поиск гербарных записей по области
   :align: center

   Рис. 4. Выделение области


.. _fig5:

.. figure:: files/search/5.png
   :alt: Поиск гербарных записей по области
   :align: center

   Рис. 5. Результаты поиска по области

Для выполнения поиска, после завершения процедуры редактирования
поисковой области, необходимо повторно нажать на кнопку поиска.
Это приведёт к ограничению результатов поиска только образцами, принадлежащей
выделенной области. Для отмены поискового условия по области необходимо
нажать на значок **урны** слева от отображаемых координат |---| границ заданной поисковой области.

.. index::  поиск по области

Выполнение поиска по более сложным |---| полигональным
поисковым областям в текущей реализации |---| на  базе MySQL |---|
не поддерживаются системой, однако,
такой вид поисковых запросов может быть эмулирован программно,
в частности, на базе использования предоставляемого сервиса автоматизации поисковых запросов
(см. :ref:`раздел Дополнительно<search_httpapi_examples>`).

